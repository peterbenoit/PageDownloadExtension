document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("maxResourceSize"),d=document.getElementById("maxTotalSize"),s=document.getElementById("downloadCss"),c=document.getElementById("downloadJs"),a=document.getElementById("downloadImages"),l=document.getElementById("downloadFonts"),r=document.getElementById("downloadVideos"),w=document.getElementById("saveButton"),I=document.getElementById("resetButton"),o=document.getElementById("statusMessage"),g=document.getElementById("downloadButton"),u=30,i=120;chrome.storage.sync.get({maxResourceSize:u,maxTotalSize:i,downloadCss:!0,downloadJs:!0,downloadImages:!0,downloadFonts:!0,downloadVideos:!0},function(e){n.value=e.maxResourceSize,d.value=e.maxTotalSize,s.checked=e.downloadCss,c.checked=e.downloadJs,a.checked=e.downloadImages,l.checked=e.downloadFonts,r.checked=e.downloadVideos}),g.addEventListener("click",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){if(e&&e[0]&&e[0].id){const t=e[0].id;chrome.tabs.sendMessage(t,{type:"TRIGGER_DOWNLOAD"},m=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),o.textContent="Error: "+chrome.runtime.lastError.message,o.style.color="#F44336"):window.close()})}})}),w.addEventListener("click",function(){const e=parseInt(n.value,10),t=parseInt(d.value,10),m=s.checked,E=c.checked,h=a.checked,y=l.checked,x=r.checked;if(isNaN(e)||e<1){o.textContent="Resource size must be at least 1 MB",o.style.color="#F44336";return}if(isNaN(t)||t<5){o.textContent="Total size must be at least 5 MB",o.style.color="#F44336";return}if(e>t){o.textContent="Resource size cannot exceed total size",o.style.color="#F44336";return}chrome.storage.sync.set({maxResourceSize:e,maxTotalSize:t,downloadCss:m,downloadJs:E,downloadImages:h,downloadFonts:y,downloadVideos:x},function(){o.textContent="Settings saved!",o.style.color="#4CAF50",setTimeout(()=>{o.textContent=""},2e3)})}),I.addEventListener("click",function(){n.value=u,d.value=i,s.checked=!0,c.checked=!0,a.checked=!0,l.checked=!0,r.checked=!0,chrome.storage.sync.set({maxResourceSize:u,maxTotalSize:i,downloadCss:!0,downloadJs:!0,downloadImages:!0,downloadFonts:!0,downloadVideos:!0},function(){o.textContent="Reset to defaults",o.style.color="#4CAF50",setTimeout(()=>{o.textContent=""},2e3)})})});
